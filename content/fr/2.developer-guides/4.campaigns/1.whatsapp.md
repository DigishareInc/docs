---
title: Campagnes WhatsApp
description: Orchestrez des campagnes WhatsApp à grand volume en utilisant des modèles de messages.
icon: i-lucide-smartphone
---

Ce guide montre comment envoyer une campagne WhatsApp en utilisant des modèles pré-approuvés. C'est la méthode standard pour les diffusions à grand volume et les notifications marketing.

::note
**Prérequis** :

- **Jeton Bearer** valide
- **ID de Modèle de Message** approuvé (par ex., `VOTRE_ID_MODELE`)
- **ID d'Étiquette d'Expéditeur** (par ex., `VOTRE_ID_EXPEDITEUR`) représentant votre canal WhatsApp.
  ::

## 1. Structure du Payload

Pour envoyer une campagne, vous effectuez une requête POST d'un payload JSON vers `/v1/campaigns`.

### Variables Communes

- `title` : Un nom pour la campagne (pour le suivi interne).
- `contacts_and_data` : Contient la configuration du message et la liste des destinataires.
- `_` : (Dans `contacts_and_data`) Configuration globale de la campagne.
  - `channel` : `whatsapp`
  - `sender_label_id` : L'ID de votre canal d'envoi.
  - `message_template_id` : L'ID du modèle que vous souhaitez envoyer.

## 2. Exemple : Modèle Standard

Si votre modèle est un message texte simple avec une variable comme `Bonjour {{1}}, votre commande {{2}} est prête.`, le payload ressemblerait à ceci :

::api-playground{method="POST" url="https://api.digishare.ma/v1/campaigns" description="Envoyez une campagne WhatsApp à plusieurs destinataires en utilisant un modèle pré-approuvé." :variables='{"token": "VOTRE_TOKEN", "senderId": "VOTRE_ID_EXPEDITEUR", "templateId": "VOTRE_ID_MODELE"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"title": "Campagne de Bienvenue", "contacts_and_data": {"\*": {"channel": "whatsapp", "sender_label_id": "{senderId}", "message_template_id": "{templateId}"}, "contacts": [{"wa_id": "212600000000", "data": {"1": "Jean", "2": "ORD-123"}}, {"wa_id": "212600000001", "data": {"1": "Jeanne", "2": "ORD-456"}}]}}'}
::

## 3. Variables Dynamiques

Les modèles WhatsApp standard utilisent souvent des variables numérotées (`{{1}}`, `{{2}}`). Dans votre liste `contacts`, vous fournissez ces valeurs dans l'objet `data` pour chaque destinataire.

::tip
Assurez-vous toujours que le nombre de variables dans votre objet `data` correspond aux variables attendues dans votre modèle approuvé pour éviter les échecs de livraison.
::

## 4. Planification (Optionnel)

Vous pouvez planifier une campagne pour le futur en ajoutant une propriété `start_datetime` (format ISO 8601) au payload de niveau supérieur.

```json
{
  "title": "Campagne Planifiée",
  "start_datetime": "2025-06-01T10:00:00Z",
  "contacts_and_data": { ... }
}
```

## 5. Tags de Conversation

Vous pouvez attribuer automatiquement des tags à la conversation générée par cette campagne en ajoutant `conversation_tags` à la configuration globale `_`.

```json
{
  "contacts_and_data": {
    "_": {
      "channel": "whatsapp",
      "conversation_tags": ["urgent", "sales_lead", "vip"]
    }
  }
}
```

### Fonctionnement

- **Conversation Directe** : Si le message crée une nouvelle conversation immédiatement, les tags sont attachés instantanément.
- **Déclencheurs (Triggers)** : Si vous utilisez un déclencheur de conversation comme `any-reply`, les tags seront stockés et appliqués **lorsque l'utilisateur répondra** et que la conversation sera réellement créée ou mise à jour.
