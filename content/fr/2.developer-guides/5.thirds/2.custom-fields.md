---
title: Gestion des Champs Personnalisés
description: Guide complet pour étendre les entités Digishare avec des métadonnées personnalisées, incluant la définition de schémas, l'indexation haute performance et le filtrage avancé.
icon: i-lucide-tags
---

Étendez vos contacts (Thirds) et autres entités avec des structures de données personnalisées adaptées à votre logique métier. Digishare prend en charge l'indexation dynamique des métadonnées, vous permettant de stocker, de vérifier le typage et de filtrer des propriétés personnalisées à la volée.

Nous proposons deux approches en fonction de vos exigences spécifiques : une Approche Rapide sans schéma strict, et une Approche API Avancée avec des schémas explicites.

---

## Approches Architecturales

::card-group
::card{title="Champs Rapides (Sans Schéma Explicite)" icon="i-lucide-zap"}
Stockez des paires clé-valeur directement dans l'objet générique `data.custom_fields` de l'entité. Les champs sont automatiquement déduits, synchronisés et indexés par le système lors de la création ou de la mise à l'entité. Idéal pour les métadonnées non structurées ou en évolution rapide.
::

::card{title="API Avancée (Schéma Strict)" icon="i-lucide-database"}
Définissez explicitement les schémas de données via l'API dédiée des Définitions de Champs Personnalisés. Cela vous permet d'appliquer un typage de données strict (`string`, `float`, `date`, `bool`, etc.), de définir des options pour les listes déroulantes (`options`) et de regrouper logiquement les champs (`group`). Parfait pour l'analyse, les intégrations systématiques et le filtrage complexe.
::
::

---

## L'Approche Rapide : `data.custom_fields`

Stockez des données personnalisées de manière implicite lors des opérations standards sur les entités. Les processus en arrière-plan de Digishare détecteront automatiquement les nouvelles clés, créeront des définitions de schémas implicites liées à votre compte et indexeront les valeurs pour des requêtes haute performance.

### 1. Création avec l'Entité Principale

Fournissez l'objet `data.custom_fields` lors de la création d'un Contact (Third).

::api-playground{method="POST" url="https://api.digishare.ma/v1/thirds" description="Créer un contact avec des champs implicites." :variables='{"token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"first_name": "Jean", "last_name": "Dupont", "data": {"custom_fields": {"balance": 150.75, "loyalty_tier": "gold", "is_vip": true}}}'}
::

### 2. Mise à Jour des Champs Existants

Modifiez la charge utile de l'entité pour fusionner de nouveaux champs ou écraser les champs personnalisés existants.

::api-playground{method="PATCH" url="https://api.digishare.ma/v1/thirds/{id}" description="Fusionner ou mettre à jour les champs personnalisés." :variables='{"id": "THIRD_ID", "token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"data": {"custom_fields": {"balance": 200.00, "last_purchase": "2026-01-18"}}}'}
::

---

## L'Approche Avancée : Schémas Explicites

Pour des implémentations d'entreprise robustes, vous pouvez définir explicitement le schéma et les propriétés de vos champs personnalisés avant d'y injecter des données. Cette approche garantit la sécurité des types et évite la prolifération de données disparates.

### 1. Définir ou Gérer les Schémas

Utilisez l'API des définitions pour dicter la manière dont les champs personnalisés doivent être traités. Les définitions de champs sont automatiquement sécurisées et limitées au contexte de l'entreprise de votre jeton d'authentification.

**Propriétés :**

- `key` (string) : L'identifiant unique du champ (ex. `account_balance`).
- `label` (string) : Le nom lisible affiché à l'utilisateur (ex. `Solde du Compte`).
- `type` (string) : Le type de données (voir les types pris en charge).
- `group` (string, optionnel) : Un regroupement logique (par défaut : `default`).
- `model_type` (string, optionnel) : L'entité à laquelle ce champ appartient (par défaut : `Third`).
- `options` (array, optionnel) : Valeurs scalaires autorisées pour les types énumérations.

::api-playground{method="POST" url="https://api.digishare.ma/v1/custom-field-definitions" description="Définir un champ avec schéma strict." :variables='{"token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"key": "loyalty_program", "label": "Programme de Fidélité", "type": "string", "group": "marketing", "model_type": "Third", "options": ["Acun", "Argent", "Or", "Platine"]}'}
::

**Récupérer les Définitions Existantes :**

::api-playground{method="GET" url="https://api.digishare.ma/v1/custom-field-definitions" description="Lister vos définitions de champs explicites." :variables='{"token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}"}'}
::

#### Types Pris en Charge

| Type     | Stockage Interne | Comportement de Conversion Auto         |
| -------- | ---------------- | --------------------------------------- |
| `string` | Texte Indexé     | Stocké tel quel                         |
| `int`    | Entier Natif     | Converti en entier                      |
| `float`  | Entier (x1000)   | Converti en décimal                     |
| `bool`   | Booléen / Bit    | `1/0`, `true/false`, `yes/no`           |
| `date`   | Entier (`Ymd`)   | Analyse l'ISO `YYYY-MM-DD` ou `DD/MM/YYYY` |

### 2. Modifier Directement les Champs

Au lieu de mettre à jour le Third en entier, ciblez directement les champs via l'endpoint dédié.

::api-playground{method="POST" url="https://api.digishare.ma/v1/thirds/{id}/custom-fields" description="Définir directement les valeurs." :variables='{"id": "THIRD_ID", "token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"fields": {"balance": 150.75, "order_count": 12}, "group": "billing"}'}
::

### 3. Récupérer les Champs

Récupérez tous les champs personnalisés rattachés à l'entité, indépendamment de la représentation parente.

::api-playground{method="GET" url="https://api.digishare.ma/v1/thirds/{id}/custom-fields" description="Obtenir les métadonnées détaillées du contact." :variables='{"id": "THIRD_ID", "token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}"}'}
::

### 4. Supprimer des Champs Spécifiques

Effacez des clés spécifiques du stockage de données de l'entité.

::api-playground{method="DELETE" url="https://api.digishare.ma/v1/thirds/{id}/custom-fields" description="Annuler/Supprimer des champs personnalisés spécifiques." :variables='{"id": "THIRD_ID", "token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"keys": ["balance", "order_count"]}'}
::

---

## Indexation & Filtrage Avancés

Digishare indexe les champs personnalisés de base, offrant des requêtes dynamiques puissantes capables d'effectuer des recherches de plages et de relations au sein de vos banques de données.

### Filtrer les Requêtes par Champs Personnalisés

Trouvez les entités qui correspondent aux contraintes de métadonnées. Les opérateurs standards fonctionnent de manière optimale sur les types `int`, `float`, et `date`.

```bash
# Contacts dépassant un solde spécifique
GET /v1/thirds?custom_filters={"balance":{"operator":">","value":100}}

# Contacts inscrits après une chronologie spécifique
GET /v1/thirds?custom_filters={"last_purchase":{"operator":">=","value":"2026-01-01"}}

# Contacts VIP où le booléen est strictement vrai
GET /v1/thirds?custom_filters={"is_vip":{"operator":"=","value":true}}
```

#### Référence des Opérateurs

| Opérateur | Comparaison |
| --------- | ----------- |
| `=`       | Égal (Par Défaut) |
| `>`       | Strictement Supérieur à |
| `<`       | Strictement Inférieur à |
| `>=`      | Supérieur ou Égal |
| `<=`      | Inférieur ou Égal |
| `!=`      | Différent de |

---

## Imports en Masse / Tableurs

Lors de l'importation de données en masse (ex. CSV / Excel), Digishare analyse les colonnes dynamiques facilement. Ajoutez le préfixe `cf_` ou `custom_` aux colonnes de votre fichier, et le moteur importera et liera nativement celles-ci comme champs personnalisés aux entités respectives.

| first_name | email            | cf_balance | cf_loyalty_tier | cf_is_vip |
| ---------- | ---------------- | ---------- | --------------- | --------- |
| Jean       | jean@example.com | 150.75     | or              | true      |
| Marie      | marie@example.com| 50.00      | argent          | false     |

---

## Matrice de Comparaison Stratégique

Déterminez la meilleure stratégie en fonction des exigences systèmes :

| Cas d'Usage / Besoins          | Champs Rapides | API Avancée |
| ------------------------------ | -------------- | ----------- |
| Prototypage Rapide             | ✅ Meilleur    | Supporté    |
| Exécution à Requête Unique     | ✅ Oui         | Multi-Requêtes |
| Restrictions Énumériques       | ❌ Non         | ✅ Oui      |
| Sécurité de Type Explicite     | ❌ Déduit      | ✅ Oui      |
| Gouvernance de Schémas         | ❌ Libre       | ✅ Oui      |
| Recherche Indexée              | ✅ Auto-sync   | ✅ Natif    |
