---
title: Import
description: Importer en masse des entités Third depuis des fichiers tableur avec support des champs personnalisés.
icon: i-lucide-upload
---

# Importer des Thirds

Importez des contacts en masse depuis des fichiers CSV ou Excel. L'import est traité de manière asynchrone via une file d'attente.

---

## Endpoint d'Import

::api-playground{method="POST" url="https://api.digishare.ma/v1/thirds/import" description="Importer des contacts depuis un fichier tableur." :variables='{"token": "YOUR_ACCESS_TOKEN"}' :headers='{"Authorization": "Bearer {token}", "Content-Type": "application/json"}' :body='{"file": "BASE64_ENCODED_FILE"}'}
::

### Corps de la Requête

| Champ | Type | Requis | Description |
|-------|------|--------|-------------|
| `file` | string | Oui | Contenu du fichier encodé en Base64 (CSV, XLSX) |
| `company_id` | string | Non | ID de l'entreprise cible (par défaut celle de l'utilisateur authentifié) |

::note
**Attribution automatique de l'entreprise.** Le `company_id` est automatiquement défini à partir de votre jeton d'authentification. Vous n'avez besoin de le fournir que si vous avez les permissions nécessaires pour importer pour une autre entreprise.
::

### Réponse

Retourne `204 No Content` immédiatement. L'import est traité en arrière-plan.

---

## Format du Fichier

Votre tableur doit inclure une ligne d'en-tête. Voici les colonnes supportées :

### Colonnes Standard

| Colonne | Description |
|---------|-------------|
| `id` | ID du third existant (pour mise à jour) |
| `ext_ref` | Référence externe (pour correspondance) |
| `first_name` | Prénom |
| `last_name` | Nom de famille |
| `name` | Nom complet |
| `email` | Adresse email |
| `mobile` | Téléphone mobile |
| `phone` | Téléphone fixe |
| `wa_id` | ID WhatsApp |
| `address` | Adresse |
| `status` | Statut actif (true/false) |
| `premium` | Indicateur premium (true/false) |
| `verified` | Indicateur vérifié (true/false) |
| `is_company` | Indicateur entreprise (true/false) |
| `tags` | Tags (séparés par point-virgule : `vip;client;prospect`) |
| `wa_ids` | IDs WhatsApp supplémentaires (séparés par point-virgule) |
| `city_id` | ID de ville (hashé) |
| `country_id` | ID de pays (hashé) |
| `state_id` | ID de région (hashé) |
| `source_id` | ID de source (hashé) |

### Colonnes de Champs Personnalisés

Ajoutez des champs personnalisés en préfixant le nom des colonnes avec `cf_` ou `custom_` :

| Colonne | Stocké Comme |
|---------|--------------|
| `cf_balance` | `balance` |
| `cf_loyalty_tier` | `loyalty_tier` |
| `custom_is_vip` | `is_vip` |

---

## Exemple de Tableur

| first_name | last_name | email | mobile | cf_balance | cf_loyalty_tier |
|------------|-----------|-------|--------|------------|-----------------|
| Jean | Dupont | jean@example.com | +212612345678 | 150.75 | gold |
| Marie | Martin | marie@example.com | +212698765432 | 50.00 | silver |
| Acme Inc | | contact@acme.com | +212522123456 | 500.00 | platinum |

---

## Comportement de l'Import

### Correspondance des Enregistrements Existants

L'import fait automatiquement correspondre les enregistrements existants par :

1. **`id`** - Si fourni, met à jour l'enregistrement existant
2. **`ext_ref`** - Correspond par référence externe au sein de l'entreprise
3. **`wa_id`** - Correspond par ID WhatsApp au sein de l'entreprise

Si aucune correspondance n'est trouvée, un nouvel enregistrement est créé.

### Synchronisation des Champs Personnalisés

Les champs personnalisés (colonnes avec préfixe `cf_` ou `custom_`) sont :

- Automatiquement synchronisés vers la base de données des Champs Personnalisés
- Types déduits des valeurs :
  - `true`, `yes`, `1`, `oui` → booléen `true`
  - `false`, `no`, `0`, `non` → booléen `false`
  - Nombres avec décimales → `float`
  - Nombres entiers → `int`
  - Autre → `string`
- Les définitions de champs sont auto-créées si elles n'existent pas

::tip
**Filtrable après import.** Une fois importés, vous pouvez filtrer les contacts par champs personnalisés via le paramètre `custom_filters`.
::

---

## Exemple cURL

```bash
# Encoder votre fichier en base64
BASE64_FILE=$(base64 -w 0 contacts.csv)

# Importer
curl -X POST "https://api.digishare.ma/v1/thirds/import" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"file\": \"$BASE64_FILE\"
  }"
```

---

## Gestion des Erreurs

| Statut | Description |
|--------|-------------|
| `204` | Import mis en file d'attente avec succès |
| `400` | Format de fichier invalide |
| `401` | Non autorisé |
| `422` | Erreur de validation (fichier requis) |

::note
**Traitement Asynchrone.** L'import s'exécute en arrière-plan. Les fichiers volumineux peuvent prendre plusieurs minutes à traiter.
::

---

## Ressources Connexes

::card-group
::card{title="Opérations CRUD" icon="i-lucide-database" to="/fr/developer-guides/thirds/crud"}
Créer des contacts individuels via l'API.
::

::card{title="Champs Personnalisés" icon="i-lucide-tags" to="/fr/developer-guides/thirds/custom-fields"}
Découvrir les champs personnalisés et le filtrage.
::
::
